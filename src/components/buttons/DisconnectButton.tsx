import React, { Dispatch, SetStateAction } from 'react'
import { BeaconWallet } from '@taquito/beacon-wallet'
import { TezosToolkit } from '@taquito/taquito'
import config from '../../utils/config'

interface ButtonProps {
  wallet: BeaconWallet | null
  setPublicToken: Dispatch<SetStateAction<string | null>>
  setUserAddress: Dispatch<SetStateAction<string>>
  setUserBalance: Dispatch<SetStateAction<number>>
  setWallet: Dispatch<SetStateAction<any>>
  setTezos: Dispatch<SetStateAction<TezosToolkit>>
  setBeaconConnection: Dispatch<SetStateAction<boolean>>
}

function DisconnectButton({
  wallet,
  setPublicToken,
  setUserAddress,
  setUserBalance,
  setWallet,
  setTezos,
  setBeaconConnection,
}: ButtonProps): JSX.Element {
  async function disconnectWallet(): Promise<void> {
    setUserAddress('')
    setUserBalance(0)
    setWallet(null)
    const tezosTK = new TezosToolkit(config.rpcURL)
    setTezos(tezosTK)
    setBeaconConnection(false)
    setPublicToken(null)
    console.log('disconnecting wallet')
    if (wallet) {
      await wallet.client.removeAllAccounts()
      await wallet.client.removeAllPeers()
      await wallet.client.destroy()
    }
  }

  return (
    <div className="buttons">
      <button className="button" onClick={disconnectWallet}>
        <i className="fas fa-times"></i>&nbsp; Disconnect wallet
      </button>
    </div>
  )
}

export default DisconnectButton
